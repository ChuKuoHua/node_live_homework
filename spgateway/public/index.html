<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js"></script>
  </head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <body>
    <div id="app">
      <div class="row mb-1">
        <div class="col-12 col-md-6">
          <h1 class="h5">建立訂單</h1>
          <form @submit.prevent="createOrder">
            <div class="mb-1 input-group">
              <span class="input-group-text">訂單編號</span>
              <input class="form-control" type="text" v-model=addOrder.MerchantOrderNo readonly>
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text">email</span>
              <input class="form-control" type="email" v-model="addOrder.Email">
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text">價格</span>
              <input class="form-control" type="number" v-model.number="addOrder.Amt">
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text">訂單資訊</span>
              <input class="form-control" type="text" v-model="addOrder.ItemDesc">
            </div>
            <button class="btn btn-outline-warning" type="submit">送出</button>
          </form>
        </div>
        <div class="col-12 col-md-6">
          <h2 class="h5">藍新付款</h2>
          <form
            action="https://ccore.newebpay.com/MPG/mpg_gateway"
            method="post"
          >
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">MerchantID (商店代號)</span>
              <input
                type="text"
                class="form-control border-0"
                id="MerchantID"
                name="MerchantID"
                value="MS148916579"
                readonly
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">TradeSha</span>
              <input
                type="text"
                class="form-control border-0"
                id="TradeSha" 
                name="TradeSha"
                v-model.number="order.TradeSha"
                readonly
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">TradeInfo</span>
              <input
                name="TradeInfo"
                type="text"
                class="form-control border-0"
                id="TradeInfo"
                v-model.number="order.TradeInfo"
                readonly>
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">TimeStamp (時間戳)</span>
              <input
                type="text"
                class="form-control border-0"
                id="TimeStamp"
                name="TimeStamp"
                v-model.number="order.TimeStamp"
                readonly>
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">Version (版本)</span>
              <input
                type="text"
                class="form-control border-0"
                id="Version"
                value="1.5"
                name="Version"
                readonly
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">MerchantOrderNo (訂單編號)</span>
              <input
                type="text"
                class="form-control border-0"
                id="MerchantOrderNo"
                v-model.number="order.MerchantOrderNo"
                name="MerchantOrderNo"
                readonly
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">ItemDesc(訂單資訊)</span>
              <input
                type="text"
                class="form-control border-0"
                id="ItemDesc" 
                name="ItemDesc"
                v-model.number="order.ItemDesc"
                readonly
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">Amt (金額)</span>
              <input
                type="text"
                class="form-control border-0"
                id="Amt"
                v-model.number="order.Amt"
                name="Amt"
                readonly
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">Email</span>
              <input
                type="text"
                class="form-control border-0"
                id="Email"
                v-model.number="order.Email"
                name="Email"
                readonly
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text border-0 bg-light">ExpireDate</span>
              <input
                type="date"
                class="form-control border-0"
                id="ExpireDate"
                name="ExpireDate"
                v-model="order.ExpireDate"
                readonly
              >
            </div>
            <button class="btn btn-success w-50" type="submit">付款</button>
          </form>
        </div>
        <div class="col-12 col-md-6">
          <h1 class="h5">訂單退款</h1>
          <form @submit.prevent="closeOrder">
            <div class="mb-1 input-group">
              <span class="input-group-text">藍新金流交易序號</span>
              <input class="form-control" type="text" v-model=closeOrderInfo.TradeNo>
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text">訂單編號</span>
              <input class="form-control" type="text" v-model=closeOrderInfo.MerchantOrderNo>
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text">退款金額</span>
              <input class="form-control" type="number" v-model.number="closeOrderInfo.Amt">
            </div>
            <button class="btn btn-outline-warning" type="submit">送出</button>
          </form>
        </div>
        <div class="col-12 col-md-6">
          <h1 class="h5">訂單退款</h1>
          <form
            action="https://ccore.newebpay.com/API/CreditCard/Close"
            method="post"
          >
            <div class="mb-1 input-group">
              <span class="input-group-text">訂單編號</span>
              <input
                class="form-control"
                type="text"
                v-model=closeOrderInfo.MerchantOrderNo readonly
                name="MerchantID_"
              >
            </div>
            <div class="mb-1 input-group">
              <span class="input-group-text">退款金額</span>
              <input class="form-control"
                type="text"
                v-model="closeOrderInfo.PostData_"
                name="PostData_"
              >
            </div>
            <button class="btn btn-outline-warning" type="submit">送出</button>
          </form>
        </div>
      </div>
    </div>

    <script type="module">
      import { createApp } from 'https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.37/vue.esm-browser.min.js';
      const app = {
        data() {
          return {
            addOrder: {
              MerchantOrderNo: Math.round(new Date().getTime() / 1000),
              Email: '',
              Amt: 1200,
              ItemDesc: '大港音樂祭'
            },
            closeOrderInfo: {
              MerchantOrderNo: '',
              Amt: 0,
              TradeNo: ''
            },
            PostData_: '',
            order: {
              MerchantOrderNo: '',
              Amt: '',
              Email: '',
              ItemDesc: '',
              TradeSha: '',
              TradeInfo: '',
              TimeStamp: '',
              ItemDesc: '',
              ExpireDate: ''
            },
          };
        },
        methods: {
          async createOrder() {
            const url = '/api/createOrder';
            const res = await axios.post(url, this.addOrder).then(res => {
              const data = res.data
              for(let key in this.order) {
                this.order[key] = data.order[key]
              }
              this.order['TradeSha'] = data['TradeSha']
              this.order['TradeInfo'] = data['TradeInfo']
            });
          },
          async closeOrder() {
            const url = '/api/closeOrder';
            const res = await axios.post(url, this.closeOrderInfo).then(res => {
              const data = res.data
              for(let key in this.closeOrderInfo) {
                this.closeOrderInfo[key] = data.order[key]
              }
              this.closeOrderInfo['PostData_'] = data.PostData_
            });
          },
        },
        async mounted() {
        },
      };

      createApp(app).mount('#app');
    </script>
  </body>
</html>
